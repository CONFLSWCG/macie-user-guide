# Researching AWS CloudTrail Data<a name="cloudtraildata"></a>

**Topics**
+ [Analyzing CloudTrail Search Results](#cloudtrailsearchresults)
+ [CloudTrail Data Fields and Sample Queries](#cloudtrailfields)

## Analyzing CloudTrail Search Results<a name="cloudtrailsearchresults"></a>

The following section describes the elements of the search results that get displayed when you use the **Research** tab to investigate your Macie\-monitored CloudTrail data\.

Complete the following steps in the **Research** tab:

1. Select **CloudTrail data** in the first filter pull\-down list\.

1. For this sample procedure, select **Top 10** in the second filter pull\-down list\.

1. For this sample procedure, select **Past 90** days in the third filter pull\-down list\.

1. Choose the button with the looking glass icon to start the search\.

Your search produces the following elements:
+ The **total number of results** that matched your CloudTrail data search for the selected time range\.
+ The **graphical representation** of CloudTrail data search results for the selected time range\. 
**Note**  
If your data set is very large and you specify a very wide time range, you data might not render properly and this graph might not be displayed as one of the resulting elements of your search\.
**Important**  
You can use the graph to further narrow your search and generate and run a query that will produce a subset of the results generated by your original selections in the steps above\. Double\-click any of the graph's results and your selection is translated into a new query that's automatically displayed in the **Query Parser**, and the **Research** tab is refreshed with the results of this new query\. 
+ **Search results summary** \- this is a list of the most significant fields from your search\. The first line includes the top \(or bottom\) 3 values for each field\. The second line includes the top \(or bottom\) 10 values for each field\. 
**Important**  
You can use the fields in the search results summary to further narrow your search and generate and run a query that will produce a subset of the results generated by your original selections in the steps above\. Choose the first or the second line of results for any field, and in the expanded results breakdown, choose the looking glass icon next to any of the results\. Your choices are then translated into a new query that's automatically displayed in the **Query Parser**, and the **Research** tab is refreshed with the results of this new query\.
+ A list of **user sessions** \(5\-minute aggregates of CloudTrail data\) that match your search criteria\. You can choose any user session to expand it and view its details\. 

## CloudTrail Data Fields and Sample Queries<a name="cloudtrailfields"></a>

The following tables include the fields that can appear in the results of your CloudTrail data searches\.
+ The first table includes the fields that Macie extracts from CloudTrail\. These fields also include Amazon S3 data events\. For example, accountId in Macie corresponds to userIdentity\.accountId in Cloudtrail, or eventNameErrorCode\.key in Macie corresponds to eventName in CloudTrail\. 
+ The second table includes the fields that are generated by Macie to provide further security intelligence and context based on the examined CloudTrail data\. For example, isp\.key describes the organization or the ISP from where the API request against your AWS resources is coming, or sourceIPAddress\.ip\_intel\.type describes the IP address history, for example, whether it's a Tor exit node that is being used to initiate API requests against your AWS resources\. 

### CloudTrail Data Fields Extracted by Macie<a name="cloudtrailfields_extracted"></a>

**Note**  
For this data repository \(CloudTrail\), your search always returns a list of user sessions \- 5\-minute aggregates of raw Cloudtrail data\. A user session is determined by the Macie unique ID \- a format that is unique to Macie for specifying users\. Macie unique ID is a combination of the IAM UserIdentity element and the recipientAccountId\. 


| Macie field name | CloudTrail field name | Macie field type | Description | Example search query | 
| --- | --- | --- | --- | --- | 
| accountId | userIdentity\.accountId | string | The AWS account ID\.  | Search for user sessions with accesses related to a particular account:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| awsRegion\.key | awsRegion | string | The AWS region to which the request is made\.  | Search for user sessions with any AWS API calls by region:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| eventNameErrorCode\.key | eventName | string |  The event name that resulted in the returned \(if any\) error code\.   |  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| eventNameErrorCode\.secondary | errorCode | string | The error code returned after an unsuccessful API request\.  | Search for user sessions with any "AccessDenied" error across all CloudTrail API events:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| eventSource\.key | eventSource | string | The service to which the request was made\.  | Search for user sessions with any API calls of a particular AWS service:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| eventType\.key | eventType | string | The type of the event that generated the event record \(for example, AwsApiCall, AwsServiceEvent, or AwsConsoleSignIn\)\.   | Search for user sessions with any AWS API calls of a particular eventType:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| objectsDeleted\.key | Resources\[0\]\.ARN | string | A list of S3 objects', S3 buckets', or prefixes ARNs that were part of a DeleteObject or a DeleteObjects API calls\.  When you delete an S3 bucket, both DeleteBucket and DeleteObjects APIs are called, and the aggregate record with the DeleteObjects call lists the deleted bucket or prefix, not all the individual objects that were deleted\.   Objects that are part of a failed DeleteObject or DeleteObjects API call are also added to the aggregate record of objectsDeleted\.key\.   A user session returning the results of a search against objectsDeleted\.key has a maximum limit of 250 records\.   |  Example search queries:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| objectsRead\.key | Resources\[0\]\.ARN | string | A list of S3 objects' ARNs that were part of a GetObject API call\.  Objects that are part of a failed GetObject API call are also added to the aggregate record of objectsRead\.key\.   A user session returning the results of a search against objectsRead\.key has a maximum limit of 250 records\.   |  Example search queries:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| objectsWritten\.key | Resources\[0\]\.ARN | string | A list of S3 objects' ARNs that were part of a PutObject, CopyObject, or CompleteMultipartUpload API calls\.  Objects that are part of a failed PutObject API call are also added to the aggregate record of objectsWritten\.key\.   A user session returning the results of a search against objectsWritten\.key has a maximum limit of 250 records\.   | Example search queries:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html) | 
| principalId | userIdentity\.principalId | string | The IAM principal ID\.   When a request is made by an assumed role, the session name is removed from the principal ID\.   | Search for user sessions wtih access requests from a particular principal ID:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| recipientAccountId | recipientAccountId | string | The AWS account ID that received the CloudTrail event\.   |  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| resourceOwnerAccountIds\.key | Resources\[1\]\.accountId | string | List of AWS resource owners\. For example, a list of AWS account IDs that own an S3 object or bucket\.   | Search for activity against resources owned by a particular AWS account:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| resources\.key | Resources\[0\]\.accountId | string | List of resources \(S3 buckets only\) associated with the CloudTrail events within the user session\.   |  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| sessionName\.key | userIdentity\.principalId | string |  The identifier for the assumed role session\. When a request is made by an assumed role, the session name is removed from the principal ID and is assigned as a value to sessionName\.key\. When a request is made by an identity other than assumed role, sessionName\.key is set to 'None'\. |  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| sourceARN | userIdentity\.arn  | string | The ARN used to make the request\.  When a request is made by an assumed role, the session name is removed from the sourceARN\.   |  Search for user sessions with access requests from a particular ARN:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| sourceIPAddress\.key | sourceIPAddress  | string | The IP address from which the request was made\.   A user session returning the results of a search against sourceIPAddress\.key has a maximum limit of 60000 records\.   |  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| userAgent\.key | userAgent  | string | A list of client user agent strings used to make the AWS API call\.  |  Search for user sessions with API calls executed by AWS S3: [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| userIdentityType\.key | userIdentity\.type   | string | A list of identity types in AWS\.  |  Search for user sessions with access requests by the root identity in an AWS account: [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 

### Fields Generated by Macie<a name="cloudtrailfields_macie-generated"></a>

**Note**  
For this data repository \(CloudTrail\), your search always returns a list of user sessions \- 5\-minute aggregates of raw Cloudtrail data\. A user session is determined by the Macie unique ID \- a format that is unique to Macie for specifying users\. Macie unique ID is a combination of the IAM UserIdentity element and the recipientAccountId\. 


| Macie field name | Macie field type | Description | Example search query | 
| --- | --- | --- | --- | 
| @timestamp | date | The start time of a user session\.  |  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| countLongLifeAccessToken | integer | A count of GetSessionToken API calls with a lifespan longer than the default 43200 seconds\.  | Search for user sessions with a user or role creating a temporary access token with a longer than the default lifespan:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| dcObjectsDeleted | integer | A count of unique S3 objects deleted in a user session\.  A user session returning the results of a search against dcObjectsDeleted has a maximum limit of 250 entries\.    | Search for user sessions with more than 25 distinct objects deleted by an AWS user or a role:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| dcObjectsRead | integer | A count of unique S3 objects read in a user session\.  A user session returning the results of a search against dcObjectsRead has a maximum limit of 250 entries\.    |  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| dcObjectsWritten | integer | A count of unique S3 objects written in a user session\.  A user session returning the results of a search against dcObjectsWritten has a maximum limit of 250 entries\.    | Search for user sessions with more than 25 distinct objects written by an AWS user or a role:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| distinctEventName | integer | A count of unique event names that take place in a user session\.  | Search for user sessions with more than 25 unique API calls being executed by a user or a role:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| distinctSourceIPAddress | integer | A count of unique source IP addresses involved in activity that takes place in a user session\. The maximum value of this count is 60,000\.  | Search for user sessions with more than 25 distinct source IP addresses observed for a user or a role:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| distinctUserAgent | integer | A count of unique client user agents involved in activity that takes place in a user session\. The maximum value of this count is 60,000\.  | Search for user sessions with more than 25 user agents observed for a user or a role:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| eventNameErrorCode\.compound | string | A compound aggregation that summarizes each CloudTrail event name along with any error codes that are associated with the API Call\. The format is EventName:ErrorCode for the term value, which allows Macie to associate an API event name with the error code, if any, that is returned\. If there is no error code for the event, then the value is set only to the API name with no colon, for example: "PutObject"\.  |  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| eventNameIsp\.compound | string | A compound aggregation that summarizes each CloudTrail event name along with the Internet Service Provider \(ISP\) from which the request originated\. The format is EventName:ISP for the term value, which allows Macie to associate an API operation name with the ISP from which it originated\.  | Search for user sessions with ConsoleLogins from non\-AWS IPs using a regular expression:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| eventNameIsp\.secondary | string | The ISP from which the AWS API call was made\.  | Search for user sessions with AWS API calls coming from outside of Amazon IP addresses:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| macieUniqueId | string | A format that is unique to Macie for specifying users\. Macie unique ID is a combination of the IAM UserIdentity element and the recipientAccountId\. For more information, see [MacieUniqueID](macie-users.md#macie-users-concepts)\.  | Search for user sessions with accesses from a particular role, user, or root account:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| sourceIPAddress\.ip\_intel\.type | string | The IP intelligence category associated with a source IP address\.  |  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| windowStartTimeInMillis | integer | The epoch timestamp for the start of a user session\.  | Search for user sessions whose first event time is greater than a given epoch time:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| windowEndTimeInMillis | integer | The epoch timestamp for the end of a user session\.  | Search for user sessions whose last event time is less than a given epoch time:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| ipLocation\.key | string | IP geolocation \(city and country\) accessed by a Macie\-monitored identity\.  |  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 
| isp\.key | string | The ISP from which the AWS API call originated\.  | Search for user sessions with AWS API calls coming from outside of Amazon IP addresses:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/macie/latest/userguide/cloudtraildata.html)  | 